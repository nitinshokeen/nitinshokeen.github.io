$(document).ready(function() {
 $('.data').hide();
 $(".button-collapse").sideNav();

 //function to get token from page url
 $.urlParam = function(name) {
  var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
  if (results == null) {
   return null;
  } else {
   return decodeURI(results[1]) || 0;
  }
 }

 var token = $.urlParam('token');
 $(".profileLink").attr("href", "profile.html?token=" + token);
 $(".feedLink").attr("href", "feed.html?token=" + token);
 var pictureLink;
 var coverLink;
 getinfo();
 $("#basicInfoData").hide();
 $("#educationData").hide();
 $("#relationshipData").hide();

 $("#overview").on("click", function() {
  event.preventDefault();
  $("#basicInfoData").slideUp(800);
  $("#educationData").slideUp(800);
  $("#relationshipData").slideUp(800);
  $("#overviewData").slideDown(800);
  $("#basicInfo").removeClass("active");
  $("#overview").addClass("active");
  $("#education").removeClass("active");
  $("#relationship").removeClass("active");
 });//end #overview on click function.
 $("#education").on("click", function() {
  event.preventDefault();
  $("#overviewData").slideUp(800);
  $("#basicInfoData").slideUp(800);
  $("#relationshipData").slideUp(800);
  $("#educationData").slideDown(600);
  $("#basicInfo").removeClass("active");
  $("#overview").removeClass("active");
  $("#education").addClass("active");
  $("#relationship").removeClass("active");
 });//end #overview on click function.
 $("#basicInfo").on("click", function() {
  event.preventDefault();
  $("#overviewData").slideUp(800);
  $("#educationData").slideUp(800);
  $("#relationshipData").slideUp(800);
  $("#basicInfoData").slideDown(800);
  $("#basicInfo").addClass("active");
  $("#overview").removeClass("active");
  $("#education").removeClass("active");
  $("#relationship").removeClass("active");
 });
 $("#relationship").on("click", function() {
  event.preventDefault();
  $("#overviewData").slideUp(800);
  $("#basicInfoData").slideUp(800);
  $("#educationData").slideUp(800);
  $("#relationshipData").slideDown(800);
  $("#basicInfo").removeClass("active");
  $("#overview").removeClass("active");
  $("#education").removeClass("active");
  $("#relationship").addClass("active");
 });

 function getinfo() {
  $.ajax('https://graph.facebook.com/me?fields=id,name,hometown,age_range,email,about,relationship_status,birthday,gender,education,cover&&access_token=' + token, {


   success: function(response) {
    console.log(typeof(response));
    $(".name").text(response.name);
    $(".email").html('<i class="fa fa-envelope-o" aria-hidden="true"></i>&ensp;' + response.email);
    $(".profileID").html('<b>Profile Link</b>&ensp; <a target="blank" href="https://facebook.com/' + response.id + '">https://facebook.com/' + response.id + '</a>');
    $(".hometown").html('<i class="fa fa-map-marker" aria-hidden="true"></i>&ensp;' + response.hometown.name);
    $(".bDay").html('<i class="fa fa-birthday-cake" aria-hidden="true"></i>&ensp;' + response.birthday);
    $(".age").html("<b>Age</b>&ensp;" + response.age_range.min);
    $('.relationshipStatus').html('<i class="fa fa-heart-o" aria-hidden="true"></i>&ensp;' + response.relationship_status);
    $('.dob').text(response.birthday);
    $('.gender').text(response.gender);
    educationInfo(response.education);
    pictureLink = "http://graph.facebook.com/" + response.id + "/picture?type=large";
    coverLink = response.cover.source;
   }, //end sucess 
   error: function(request, errorType, errorMessage) {
    console.log(request);
    console.log(errorType);
    Materialize.toast(errorMessage, 3000);
    Materialize.toast("Invalid access token.");
    var $toastContent = $('<span>Please try again.</span>').add($('<button class="btn-flat toast-action"><a href="index.html">Retry</a></button>'));
    Materialize.toast($toastContent);
   }, //end error 

   timeout: 5000,

   beforeSend: function() {

    $('.loader').show();

   }, //end beforeSend 

   complete: function() {

     $('.loader').hide();
     $('.padding').removeClass("padding");
     $('.data').show();
     $("#coverPic").attr("src", coverLink);
     $(".profilePic").attr("src", pictureLink);

    } //end complete 


  }); //end ajax
 } //end getInfo

 //function to get education information of the user.
 function educationInfo(array) {
  var college, highSchool;
  for (x in array) {
   if (array[x].type == "High School") {
    highSchool = array[x].school.name + "<br>";
    $('.highSchool').append(highSchool);
   }
   if (array[x].type == "College") {
    college = array[x].school.name + "<br>" + array[x].concentration[0].name + "<br>";
    $('.college').append(college);
   }
  }
 };//end educationInfo function.
});